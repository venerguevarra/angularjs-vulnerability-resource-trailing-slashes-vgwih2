<!DOCTYPE html>
<html>
  <head>
    <title>
      AngularJS vulnerability: `$resource` trailing slashes ReDoS
    </title>

    <meta name="author" content="XLTS.dev" />
    <meta
      name="description"
      content="A minimal reproduction of an AngularJS ReDoS vulnerability related to `$resource`."
    />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <h1>
      <small>Reproduction of AngularJS vulnerability:</small><br />
      <code>$resource</code> trailing slashes ReDoS
    </h1>

    <section class="vulnerability-info-section">
      <h2>Vulnerability information</h2>
      <table class="vulnerability-info-table">
        <tr>
          <th>Type:</th>
          <td><a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">ReDoS</a></td>
        </tr>
        <tr>
          <th>Affected versions:</th>
          <td>&gt;=v1.0.0</td>
        </tr>
        <tr>
          <th>Fixed in version:</th>
          <td><a href="https://xlts.dev/angularjs">XLTS for AngularJS</a> v1.9.1 and v1.5.17</td>
        </tr>
        <tr>
          <th>Description:</th>
          <td>
            A regular expression used by the <code>$resource</code> service to <a href="https://docs.angularjs.org/api/ngResource/service/$resource#:~:text=stripTrailingSlashes,-%E2%80%93%20%7Bboolean%7D">strip trailing slashes</a> is vulnerable to super-linear runtime due to backtracking.
            With a large carefully-crafted input, this can result in catastrophic backtracking and cause a denial of service of the application, also known as a <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">ReDoS attack</a>.
          </td>
        </tr>
      </table>
    </section>

    <section class="repro-instructions-section">
      <h2>Reproduction instructions</h2>
      <p>
        The app below demonstrates the issue by using a user-provided URL suffix to <code>$resource</code>.
      </p>
      <p>
        It is essentially the equivalent of:
        <pre>
          $resource(`/some/url/${userProvidedSuffix}`).query();
        </pre>
      </p>
      <p>
        <b>Steps:</b>
        <ol>
          <li>
            Set the URL suffix to a value containing many slashes (<code>/</code>) followed by a non-slash character.
          </li>
          <li>
            You can click one of the available buttons to set the URL suffix to a value with many slashes.
          </li>
          <li>
            Click the "Send request" button to trigger <code>$resource</code> to process the URL for the request.<br />
            <blockquote>
              ðŸ“Œ <b>NOTICE:</b>
              <i>The tab will be unresponsive while the URL is being processed. The more slashes in the URL suffix, the longer the tab will remain unresponsive.</i>
            </blockquote>
          </li>
          <li>
            Observe that the time it takes to process each URL increases super-linearly relative to the URL length.
          </li>
        </ol>
      </p>
    </section>

    <section class="repro-content-section" ng-app="app" ng-controller="AppCtrl as $ctrl">
      <h2>Reproduction</h2>
      <p>
        Set URL suffix to value with N trailing slashes:<br />
        <button
            ng-repeat="n in [15, 16, 17, 18, 19, 20]"
            ng-click="$ctrl.setUrlSuffixWithSlashesPowerOf2Exponent(n)">
          2^{{ n }}
        </button>
      </p>
      <p>
        <label>
          URL suffix:
          <input ng-model="$ctrl.urlSuffix" />
          (length: {{ $ctrl.urlSuffix.length | number }})
        </label>
      </p>
      <p>
        <button class="repro-btn" ng-click="$ctrl.sendRequest()">Send request</button>
        <span class="repro-duration">Time to process URL: <b>{{ $ctrl.duration }}</b></span>
      </p>
    </section>
  </body>
</html>
